
@{
    ViewBag.Title = "Index";
}


<h2>Clientes</h2>

<div>
    <button style="margin-right:30px;" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Agregar</button>
</div>
<br />

<div>
    <table class="table table-striped table-dark">
        <thead>
            <tr>
                <th scope="col">idCliente</th>
                <th scope="col">Nombre</th>
                <th scope="col">ApellidoP</th>
                <th scope="col">ApellidoM</th>
                <th scope="col">Teléfono</th>
                <th scope="col">Acciones</th>
            </tr>
        </thead>
        <tbody id="tbody">
        </tbody>
    </table>
</div>
<!-- Modal INSERT -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 text-dark" id="exampleModalLabel">Agregar</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body text-dark">
                <input id="Nom" class="form-control" type="text" placeholder="Nombre" aria-label="default input example"><br />
                <div class="input-group mb-3">
                </div>

                <div class="modal-body text-dark">
                    <input id="AP" class="form-control" type="text" placeholder="ApellidoP" aria-label="default input example"><br />
                    <div class="input-group mb-3">
                    </div>

                    <input id="AM" class="form-control" type="text" placeholder="ApellidoM" aria-label="default input example"><br />
                    <div class="input-group mb-3">
                    </div>

                    <div class="modal-body text-dark">
                        <input id="Tel" class="form-control" type="text" placeholder="Teléfono" aria-label="default input example"><br />
                        <div class="input-group mb-3">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" onclick="insertCliente()" class="btn btn-primary">Guardar</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 text-dark" id="exampleModalLabel">Actualizar Cliente</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-dark">
                <div class="m-2">
                    <p class="m-0">Id:</p>
                    <input id="clientidU" class="form-control" type="text" placeholder="Id" aria-label="default input example" readonly>
                </div>
                <div class="m-2">
                    <p class="m-0">Nombre:</p>
                    <input id="NomU" class="form-control" type="text" placeholder="Nombre" aria-label="default input example">
                </div>
                <div class="m-2">
                    <p class="m-0">ApellidoP:</p>
                    <input id="APU" class="form-control" type="text" placeholder="ApellidoP" aria-label="default input example">
                </div>
                <div class="m-2">
                    <p class="m-0">ApellidoM:</p>
                    <input id="AMU" class="form-control" type="text" placeholder="ApellidoM" aria-label="default input example">
                </div>
                <div class="m-2">
                    <p class="m-0">Telefono:</p>
                    <input id="TelU" class="form-control" type="text" placeholder="Teléfono" aria-label="default input example">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" onclick="actualizar()" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </div>
    </div>
</div>

    

    <script>
       
        var rest;

    $(document).ready(function () {
        createtable();
    });
    function createtable() {
    $.ajax({
        url: '@Url.Action("Select", "Clientes")',
        type: "POST",
        data: { },
        dataType: "json",
        success: function (d) {
            var count = d.length;
            rest = d;
            $('#tbody').empty();
            for(i = 0; i < count; i++) {
                 var contenido = '<tr>';
                 contenido += '<td>' + d[i].idCliente +'</td>';
                 contenido += '<td>' + d[i].Nombre +'</td>';
                contenido += '<td>' + d[i].ApellidoP +'</td>';
                contenido += '<td>' + d[i].ApellidoM + '</td>';
                contenido += '<td>' + d[i].Teléfono + '</td>';
                contenido += '<td><button style="margin-right:30px;" class="btn btn-danger" onclick="Delete(' + d[i].idCliente + ')">Eliminar</button><button style="margin-right:30px;" class="btn btn-warning" onclick="showModal_(' + i + ')">Editar</button></td>';
                 contenido += '</tr>';
                 $('#tbody').append(contenido);
             }
        },
        error: function (d) {
            alert('Error de validacion. '+ d);
        }
    });

    };
    function Delete(id){
     $.ajax({
         url: '@Url.Action("delete", "Clientes")',
         type: "POST",
         data: { Id: id },
         dataType: "json",
         success: function (d) {
             if (d=="OK") {
                 alert('Cliente borrado');
                 createtable();
             }
         },
         error: function (d) {
             alert('Error de validacion. '+ d);
         }
     });
 }
 function insertCliente() {
    var nombre = $('#Nom').val();
    var apellidoP = $('#AP').val();
    var apellidoM = $('#AM').val();
    var teléfono = $('#Tel').val();


    $.ajax({
        url: '@Url.Action("Insert", "Clientes")',
        type: "POST",
        data: { Nombre: nombre, ApellidoP: apellidoP, ApellidoM: apellidoM, Teléfono: teléfono},
        dataType: "json",
        success: function (d) {
            if (d == "OK") {
                $("#exampleModal").modal('hide')
                alert('Cliente guardado.');
                createtable();
            }
        },
        error: function (d) {
            alert('Error de validacion. ' + d);
        }
    });
}

 function showModal(ID) {
     $.ajax({
         url: '@Url.Action("GetById", "Clientes")',
         type: "POST",
         data: { ID: ID},
         dataType: "json",
         success: function (d) {
             //$('#clientidI').val(d.idCliente);
             $('#NomI').val(d.Nombre);
             $('#API').val(d.ApellidoP);
             $('#AMI').val(d.ApellidoM);
             $('#TelI').val(d.Teléfono);
             $("#exampleModal").modal("show");
         },
         error: function (d) {
             alert('Error de validacion. ' + d);
         }
     });
 };

  function updateCliente() {
        var ID = $('#clientidU').val();
        var nombre = $('#NomU').val();
        var apellidoP = $('#APU').val();
        var apellidoM = $('#AMU').val();
        var teléfono = $('#TelU').val();

    $.ajax({
        url: '@Url.Action("Update", "Clientes")',
        type: "POST",
        data: {IdCliente: ID, Nombre: nombre, ApellidoP: apellidoP, ApellidoM: apellidoM, Teléfono: teléfono},
        dataType: "json",
        success: function (d) {
            if (d == "OK") {
                alert('Cliente actualizado.');
                location.reload();
            }
        },
        error: function (d) {
            alert('Error de validacion. ' + d);
        }
    });
        }
        function actualizar() {
            var nombre = $('#NomU').val()
            if (nombre == "") {
                alert("El campo Nombre no puede estar vacío")

                return
            }

             $.ajax({
                url: '@Url.Action("Update", "Clientes")',
                type: "POST",
                 data: { IdCliente: $('#clientidU').val() , Nombre: $('#NomU').val() , ApellidoP:  $('#APU').val(), ApellidoM:  $('#AMU').val(), Teléfono: $('#TelU').val() },
                dataType: "json",
                 success: function (d) {
                     $("#exampleModal2").modal('hide')
                    alert("Datos actualizados")
                    createtable();

                },
                error: function (d) {
                    alert('Error de validacion. ' + d);
                }
            });
        } 

        function showModal_(i) {
            $('#clientidU').val(rest[i].idCliente);
            $('#NomU').val(rest[i].Nombre);
            $('#APU').val(rest[i].ApellidoP);
            $('#AMU').val(rest[i].ApellidoM);
            $('#TelU').val(rest[i].Teléfono);
            $("#exampleModal2").modal("show");

        

 };

    </script>
